\hypertarget{_s_r_tools_8h_source}{}\doxysection{SRTools.\+h}
\label{_s_r_tools_8h_source}\index{/Users/giuliocarota/CLionProjects/screenreclib/include/SRTools.h@{/Users/giuliocarota/CLionProjects/screenreclib/include/SRTools.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{//}}
\DoxyCodeLine{2 \textcolor{comment}{// Created by giuli on 27/12/2021.}}
\DoxyCodeLine{3 \textcolor{comment}{//}}
\DoxyCodeLine{4 }
\DoxyCodeLine{5 \textcolor{preprocessor}{\#ifndef SCREENRECLIB\_SRTOOLS\_H}}
\DoxyCodeLine{6 \textcolor{preprocessor}{\#define SCREENRECLIB\_SRTOOLS\_H}}
\DoxyCodeLine{7 }
\DoxyCodeLine{8 \textcolor{preprocessor}{\#define AUTO\_RESOLUTION SRResolution\{0,0\}}}
\DoxyCodeLine{9 \textcolor{preprocessor}{\#define NULL\_RESOLUTION SRResolution\{0,0\}}}
\DoxyCodeLine{10 }
\DoxyCodeLine{11 \textcolor{preprocessor}{\#include <iostream>}}
\DoxyCodeLine{12 \textcolor{preprocessor}{\#include <cstdio>}}
\DoxyCodeLine{13 \textcolor{preprocessor}{\#include <cstdlib>}}
\DoxyCodeLine{14 \textcolor{preprocessor}{\#include <fstream>}}
\DoxyCodeLine{15 \textcolor{preprocessor}{\#include <cstring>}}
\DoxyCodeLine{16 \textcolor{preprocessor}{\#include <cmath>}}
\DoxyCodeLine{17 \textcolor{preprocessor}{\#include <ctime>}}
\DoxyCodeLine{18 }
\DoxyCodeLine{19 \textcolor{preprocessor}{\#include <cstring>}}
\DoxyCodeLine{20 \textcolor{preprocessor}{\#include <queue>}}
\DoxyCodeLine{21 \textcolor{preprocessor}{\#include <mutex>}}
\DoxyCodeLine{22 \textcolor{preprocessor}{\#include <condition\_variable>}}
\DoxyCodeLine{23 \textcolor{preprocessor}{\#include <thread>}}
\DoxyCodeLine{24 \textcolor{preprocessor}{\#include <assert.h>}}
\DoxyCodeLine{25 \textcolor{preprocessor}{\#include "{}exceptions/SRExceptions.h"{}}}
\DoxyCodeLine{26 }
\DoxyCodeLine{27 \textcolor{keyword}{extern} \textcolor{stringliteral}{"{}C"{}} \{}
\DoxyCodeLine{28 \textcolor{preprocessor}{\#include <libavcodec/avcodec.h>}}
\DoxyCodeLine{29 \textcolor{preprocessor}{\#include <libavcodec/avfft.h>}}
\DoxyCodeLine{30 \textcolor{preprocessor}{\#include <libavdevice/avdevice.h>}}
\DoxyCodeLine{31 \textcolor{preprocessor}{\#include <libavfilter/avfilter.h>}}
\DoxyCodeLine{32 \textcolor{preprocessor}{\#include <libavfilter/buffersink.h>}}
\DoxyCodeLine{33 \textcolor{preprocessor}{\#include <libavfilter/buffersrc.h>}}
\DoxyCodeLine{34 \textcolor{preprocessor}{\#include <libavformat/avformat.h>}}
\DoxyCodeLine{35 \textcolor{preprocessor}{\#include <libavformat/avio.h>}}
\DoxyCodeLine{36 }
\DoxyCodeLine{37 \textcolor{preprocessor}{\#include "{}libavutil/opt.h"{}}}
\DoxyCodeLine{38 \textcolor{preprocessor}{\#include "{}libavutil/common.h"{}}}
\DoxyCodeLine{39 \textcolor{preprocessor}{\#include "{}libavutil/channel\_layout.h"{}}}
\DoxyCodeLine{40 \textcolor{preprocessor}{\#include "{}libavutil/imgutils.h"{}}}
\DoxyCodeLine{41 \textcolor{preprocessor}{\#include "{}libavutil/mathematics.h"{}}}
\DoxyCodeLine{42 \textcolor{preprocessor}{\#include "{}libavutil/samplefmt.h"{}}}
\DoxyCodeLine{43 \textcolor{preprocessor}{\#include "{}libavutil/time.h"{}}}
\DoxyCodeLine{44 \textcolor{preprocessor}{\#include "{}libavutil/opt.h"{}}}
\DoxyCodeLine{45 \textcolor{preprocessor}{\#include "{}libavutil/pixdesc.h"{}}}
\DoxyCodeLine{46 \textcolor{preprocessor}{\#include "{}libavutil/file.h"{}}}
\DoxyCodeLine{47 \textcolor{preprocessor}{\#include "{}libavutil/audio\_fifo.h"{}}}
\DoxyCodeLine{48 \textcolor{preprocessor}{\#include "{}libswscale/swscale.h"{}}}
\DoxyCodeLine{49 \textcolor{preprocessor}{\#include "{}libswresample/swresample.h"{}}}
\DoxyCodeLine{50 \}}
\DoxyCodeLine{51 }
\DoxyCodeLine{52 }
\DoxyCodeLine{53 \textcolor{keyword}{using namespace  }std;}
\DoxyCodeLine{54 \textcolor{keyword}{typedef} \textcolor{keyword}{struct }\mbox{\hyperlink{struct_r}{R}}\{}
\DoxyCodeLine{55     \textcolor{keywordtype}{double} num;}
\DoxyCodeLine{56     \textcolor{keywordtype}{double} den;}
\DoxyCodeLine{57 \}\mbox{\hyperlink{struct_r}{SRRational}};}
\DoxyCodeLine{58 \textcolor{keyword}{typedef} \textcolor{keyword}{struct }\mbox{\hyperlink{struct_s}{S}}\{}
\DoxyCodeLine{59     \textcolor{keywordtype}{int} width;}
\DoxyCodeLine{60     \textcolor{keywordtype}{int} height;}
\DoxyCodeLine{61 \}\mbox{\hyperlink{struct_s}{SRResolution}};}
\DoxyCodeLine{62 }
\DoxyCodeLine{63 \textcolor{keyword}{typedef} \textcolor{keyword}{struct }\mbox{\hyperlink{struct_m}{M}} \{}
\DoxyCodeLine{64     \textcolor{keywordtype}{int} x;}
\DoxyCodeLine{65     \textcolor{keywordtype}{int} y;}
\DoxyCodeLine{66 \}\mbox{\hyperlink{struct_m}{SROffset}};}
\DoxyCodeLine{67 }
\DoxyCodeLine{68 \textcolor{keyword}{typedef} \textcolor{keyword}{struct }\mbox{\hyperlink{struct_v}{V}}\{}
\DoxyCodeLine{69     \mbox{\hyperlink{struct_r}{SRRational}} width;}
\DoxyCodeLine{70     \mbox{\hyperlink{struct_r}{SRRational}} height;}
\DoxyCodeLine{71 \}\mbox{\hyperlink{struct_v}{SRResolutionRational}};}
\DoxyCodeLine{72 }
\DoxyCodeLine{73 \textcolor{keyword}{typedef} \textcolor{keyword}{struct }\mbox{\hyperlink{struct_z}{Z}} \{}
\DoxyCodeLine{74     \mbox{\hyperlink{struct_r}{SRRational}} x;}
\DoxyCodeLine{75     \mbox{\hyperlink{struct_r}{SRRational}} y;}
\DoxyCodeLine{76 \}\mbox{\hyperlink{struct_z}{SROffsetRational}};}
\DoxyCodeLine{77 }
\DoxyCodeLine{78 \textcolor{keyword}{typedef} \textcolor{keyword}{struct }\mbox{\hyperlink{struct_t}{T}}\{}
\DoxyCodeLine{79     \mbox{\hyperlink{struct_z}{SROffsetRational}} offset;}
\DoxyCodeLine{80     \mbox{\hyperlink{struct_v}{SRResolutionRational}} dimension;}
\DoxyCodeLine{81 \}\mbox{\hyperlink{struct_t}{SRCropRegion}};}
\DoxyCodeLine{82 }
\DoxyCodeLine{83 \textcolor{keyword}{typedef} \textcolor{keyword}{struct }\mbox{\hyperlink{struct_a}{A}}\{}
\DoxyCodeLine{84     \mbox{\hyperlink{struct_t}{SRCropRegion}} crop;}
\DoxyCodeLine{85     \mbox{\hyperlink{struct_s}{SRResolution}}  outscreenres;}
\DoxyCodeLine{86     uint16\_t  fps;}
\DoxyCodeLine{87     \textcolor{keywordtype}{int} audio\_samplerate;}
\DoxyCodeLine{88     \textcolor{keywordtype}{int} audio\_channels;}
\DoxyCodeLine{89     \textcolor{keywordtype}{string} filename;}
\DoxyCodeLine{90     AVCodecID audio\_codec;}
\DoxyCodeLine{91     AVCodecID video\_codec;}
\DoxyCodeLine{92     \textcolor{keywordtype}{bool} enable\_crop;}
\DoxyCodeLine{93 \}\mbox{\hyperlink{struct_a}{SROutputSettings}};}
\DoxyCodeLine{94 }
\DoxyCodeLine{95 \textcolor{keyword}{typedef} \textcolor{keyword}{struct }\mbox{\hyperlink{struct_b}{B}}\{}
\DoxyCodeLine{96    \textcolor{keywordtype}{bool} enable\_audio;}
\DoxyCodeLine{97    \textcolor{keywordtype}{bool} enable\_video;}
\DoxyCodeLine{98    \textcolor{keywordtype}{bool} enable\_crop;}
\DoxyCodeLine{99    \mbox{\hyperlink{struct_t}{SRCropRegion}} crop\_info;}
\DoxyCodeLine{100    \textcolor{keywordtype}{string} filename;}
\DoxyCodeLine{101    \textcolor{keywordtype}{string} video\_url;}
\DoxyCodeLine{102    \textcolor{keywordtype}{string} audio\_url;}
\DoxyCodeLine{103 \}\mbox{\hyperlink{struct_b}{SRConfiguration}};}
\DoxyCodeLine{104 }
\DoxyCodeLine{105 \textcolor{keyword}{static} \mbox{\hyperlink{struct_s}{SRResolution}} rescale\_resolution(\mbox{\hyperlink{struct_s}{SRResolution}} input, \mbox{\hyperlink{struct_v}{SRResolutionRational}} rescaler)\{}
\DoxyCodeLine{106     \mbox{\hyperlink{struct_s}{SRResolution}}  out;}
\DoxyCodeLine{107     out.width = floor(input.width* rescaler.width.num / rescaler.width.den);}
\DoxyCodeLine{108     \textcolor{keywordflow}{if}(out.width\%2 != 0) out.width += 1;}
\DoxyCodeLine{109     out.height = floor(input.height* rescaler.height.num / rescaler.height.den);}
\DoxyCodeLine{110     \textcolor{keywordflow}{if}(out.height\%2 != 0) out.height += 1;}
\DoxyCodeLine{111 }
\DoxyCodeLine{112     \textcolor{keywordflow}{return} out;}
\DoxyCodeLine{113 \}}
\DoxyCodeLine{114 }
\DoxyCodeLine{115 \textcolor{keyword}{static} \mbox{\hyperlink{struct_m}{SROffset}} rescale\_offset(\mbox{\hyperlink{struct_s}{SRResolution}} input, \mbox{\hyperlink{struct_z}{SROffsetRational}} rescaler)\{}
\DoxyCodeLine{116     \mbox{\hyperlink{struct_m}{SROffset}} out;}
\DoxyCodeLine{117     out.x = ceil(input.width*rescaler.x.num / rescaler.x.den);}
\DoxyCodeLine{118     out.y = ceil(input.height*rescaler.y.num / rescaler.y.den);}
\DoxyCodeLine{119     \textcolor{keywordflow}{return} out;}
\DoxyCodeLine{120 \}}
\DoxyCodeLine{121 }
\DoxyCodeLine{122 \textcolor{keyword}{static} \textcolor{keywordtype}{void} lock\_thread\_for(\textcolor{keywordtype}{int} sec)\{}
\DoxyCodeLine{123     std::this\_thread::sleep\_for(std::chrono::milliseconds(sec*1000));}
\DoxyCodeLine{124 \}}
\DoxyCodeLine{125 }
\DoxyCodeLine{126 \textcolor{keyword}{static} \textcolor{keywordtype}{bool} assertMP4(\textcolor{keywordtype}{string} filename)\{}
\DoxyCodeLine{127     filename = filename.substr(filename.find\_last\_of(\textcolor{charliteral}{'.'}));}
\DoxyCodeLine{128     \textcolor{keywordflow}{if}(filename!=\textcolor{stringliteral}{"{}.mp4"{}})}
\DoxyCodeLine{129         \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{130     \textcolor{keywordflow}{else}}
\DoxyCodeLine{131         \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{132 \}}
\DoxyCodeLine{133 }
\DoxyCodeLine{134 \textcolor{preprocessor}{\#endif }\textcolor{comment}{//SCREENRECLIB\_SRTOOLS\_H}}
\DoxyCodeLine{135 }

\end{DoxyCode}
